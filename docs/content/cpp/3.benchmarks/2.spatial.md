---
title: Spatial
description: Tree construction and proximity queries.
navigation:
  icon: i-lucide-scale-3d
---

Benchmarks for `tf::tree` construction and spatial queries. See [experimental setup](/cpp/benchmarks#experimental-setup) for methodology.

## Point Clouds

### Tree Construction

Construction time for spatial index structures over mesh vertices. TrueForm builds trees with AABB, OBB, and OBBRSS bounding volumes; [nanoflann](https://github.com/jlblancoc/nanoflann) builds a k-d tree. Each configuration is measured 10 times; the min is reported.

Source: [TrueForm](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/point_cloud-build_tree-tf-impl.cpp), [nanoflann](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/point_cloud-build_tree-nanoflann-impl.cpp)

::ChartsSpatialPointCloudBuild{class="my-12"}
::

::ChartsSpatialPointCloudBuildSpeedup{class="my-12"}
::

TrueForm AABB tree construction is 7× faster than nanoflann's k-d tree at 1M points, while also supporting OBB and OBBRSS bounding volumes.

### k-Nearest Neighbor

Query time for k nearest neighbors. Query points are generated by adding uniform random offsets (within 1% of bounding box diagonal) to mesh vertices. For each mesh size, 1000 queries are executed; the mean time per query is reported. Results shown for k=10.

Source: [TrueForm](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/point_cloud-knn-tf-impl.cpp), [nanoflann](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/point_cloud-knn-nanoflann-impl.cpp)

::ChartsSpatialKnn{class="my-12"}
::

::ChartsSpatialKnnSpeedup{class="my-12"}
::

TrueForm k-NN queries are 3× faster than nanoflann at 500K points.

## Polygon Meshes

### BVH Construction

Construction time for bounding volume hierarchies over triangle meshes. TrueForm trees use arity 4 and leaf size 4. Each configuration is measured 10 times; the min is reported.

#### AABB

Tree using [axis-aligned bounding boxes](https://en.wikipedia.org/wiki/Bounding_volume#Common_types). TrueForm is compared against [CGAL](https://www.cgal.org/) AABB trees, [FCL](https://github.com/flexible-collision-library/fcl) `BVHModel<AABB>`, and [Coal](https://github.com/coal-library/coal) `BVHModel<AABB>`.

Source: [TrueForm](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-tf-impl.cpp), [CGAL](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-cgal-impl.cpp), [FCL](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-fcl-impl.cpp), [Coal](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-coal-impl.cpp)

::ChartsSpatialPolygonsBuildAabb{class="my-12"}
::

::ChartsSpatialPolygonsBuildAabbSpeedup{class="my-12"}
::

TrueForm AABB tree construction is 21× faster than FCL, 15× faster than CGAL, and 14× faster than Coal at 1M polygons.

#### OBB

Tree using [oriented bounding boxes](https://en.wikipedia.org/wiki/Minimum_bounding_box#Arbitrarily_oriented_minimum_bounding_box). TrueForm is compared against [FCL](https://github.com/flexible-collision-library/fcl) `BVHModel<OBB>` and [Coal](https://github.com/coal-library/coal) `BVHModel<OBB>`.

Source: [TrueForm](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-tf-impl.cpp), [FCL](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-fcl-impl.cpp), [Coal](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-coal-impl.cpp)

::ChartsSpatialPolygonsBuildObb{class="my-12"}
::

::ChartsSpatialPolygonsBuildObbSpeedup{class="my-12"}
::

TrueForm OBB tree construction is 30× faster than FCL and 26× faster than Coal at 1M polygons.

#### OBBRSS

Tree using a hybrid of oriented bounding boxes and [rectangle swept spheres](https://gamma.cs.unc.edu/SSV/). TrueForm is compared against [FCL](https://github.com/flexible-collision-library/fcl) `BVHModel<OBBRSS>` and [Coal](https://github.com/coal-library/coal) `BVHModel<OBBRSS>`.

Source: [TrueForm](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-tf-impl.cpp), [FCL](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-fcl-impl.cpp), [Coal](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons-build_tree-coal-impl.cpp)

::ChartsSpatialPolygonsBuildObbrss{class="my-12"}
::

::ChartsSpatialPolygonsBuildObbrssSpeedup{class="my-12"}
::

TrueForm OBBRSS tree construction is 27× faster than FCL and 24× faster than Coal at 1M polygons.

### Mesh-to-Mesh Distance

Minimum distance computation between two copies of the same mesh. The second mesh is placed at a random rigid transform sampled uniformly within a sphere of radius equal to twice the bounding box diagonal. For each mesh size, 1000 random configurations are evaluated; the mean query time is reported. TrueForm uses `tf::neighbor_search` on polygon forms; [FCL](https://github.com/flexible-collision-library/fcl) uses `fcl::distance()` and [Coal](https://github.com/coal-library/coal) uses `coal::distance()` with the corresponding `BVHModel<BV>`.

#### AABB

Using [axis-aligned bounding boxes](https://en.wikipedia.org/wiki/Bounding_volume#Common_types). Coal is excluded from this comparison as its AABB distance queries are slower than FCL (see [OBBRSS](#obbrss-1) for Coal results).

Source: [TrueForm](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons_to_polygons-closest_point-tf-impl.cpp), [FCL](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons_to_polygons-closest_point-fcl-impl.cpp)

::ChartsSpatialMeshMeshDistanceAabb{class="my-12"}
::

::ChartsSpatialMeshMeshDistanceAabbSpeedup{class="my-12"}
::

TrueForm mesh-to-mesh distance queries with AABB are 469× faster than FCL at 1M polygons per mesh.

#### OBBRSS

Using a hybrid of oriented bounding boxes and [rectangle swept spheres](https://gamma.cs.unc.edu/SSV/).

Source: [TrueForm](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons_to_polygons-closest_point-tf-impl.cpp), [FCL](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons_to_polygons-closest_point-fcl-impl.cpp), [Coal](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/polygons_to_polygons-closest_point-coal-impl.cpp)

::ChartsSpatialMeshMeshDistanceObbrss{class="my-12"}
::

::ChartsSpatialMeshMeshDistanceObbrssSpeedup{class="my-12"}
::

TrueForm mesh-to-mesh distance queries with OBBRSS are 2× faster than FCL and Coal at 1M polygons per mesh. The smaller gap compared to AABB reflects that OBBRSS provides tighter bounds, reducing the number of primitive tests for all libraries.

## Incremental Tree Updates

Update time for `tf::mod_tree` when a contiguous region of primitives changes. Dirty primitives are selected by growing a region from a random seed vertex via BFS, simulating localized edits. The tree prunes affected nodes and rebuilds only the delta.

Source: [TrueForm](https://github.com/polydera/trueform/blob/main/benchmarks/spatial/mod_tree-update-tf-impl.cpp)

::ChartsSpatialModTreeUpdate{class="my-12"}
::

The efficiency chart below shows the ratio of dirty percentage to update percentage. A value of 1.0 means perfect scaling: updating X% of primitives takes X% of full build time.

::ChartsSpatialModTreeEfficiency{class="my-12"}
::

Efficiency improves with both mesh size and dirty percentage. At low dirty percentages (1–5%), there is a fixed overhead from tree traversal and delta management, resulting in efficiencies of 0.3–0.6. As the dirty region grows, this overhead is amortized: at 40% dirty, efficiency approaches 0.9–1.0 across all mesh sizes.

Larger meshes benefit more from incremental updates. At 1M polygons, the fixed overhead is only ~1.3%, making incremental updates worthwhile even for small localized changes.
